<li class="list-group-item library-node-item" data-node-id="{{ node.pk }}" data-node-depth="{{ node.depth }}">
    <div class="d-flex justify-content-between align-items-center">
        <span class="node-title ps-{{ node.depth|add:"-1" }}">{{ node.item }} (ID: {{ node.pk }})</span>
        <div class="node-actions btn-group btn-group-sm" role="group">
            <button type="button" class="btn btn-outline-primary add-node-btn" data-action-type="add_child" data-bs-toggle="modal" data-bs-target="#addNodeModal">Add Child</button>
            
            {% if node.depth > 1 %} {# Only show sibling/parent/delete options for non-root nodes #}
            <div class="btn-group" role="group">
                <button id="btnGroupDrop1-{{ node.pk }}" type="button" class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    Add Sibling
                </button>
                <ul class="dropdown-menu" aria-labelledby="btnGroupDrop1-{{ node.pk }}">
                    <li><a class="dropdown-item add-node-btn" href="#" data-action-type="add_sibling_left" data-bs-toggle="modal" data-bs-target="#addNodeModal">Add Sibling (Left)</a></li>
                    <li><a class="dropdown-item add-node-btn" href="#" data-action-type="add_sibling_right" data-bs-toggle="modal" data-bs-target="#addNodeModal">Add Sibling (Right)</a></li>
                </ul>
            </div>
            <button type="button" class="btn btn-outline-primary add-node-btn" data-action-type="add_parent" data-bs-toggle="modal" data-bs-target="#addNodeModal">Add Parent</button>
            <button type="button" class="btn btn-outline-danger delete-node-btn" data-node-id="{{ node.pk }}" data-node-item="{{ node.item }}" data-bs-toggle="modal" data-bs-target="#deleteNodeConfirmModal">Delete</button>
            {% endif %}
            
        </div>
    </div>
    {% if node.content_object %}
        <div class="node-content ps-{{ node.depth }} text-muted small">{{ node.content_object.text|truncatechars:100 }}</div>
    {% endif %}

    {% if node.get_children %}
        <ul class="list-unstyled mt-2">
            {% for child in node.get_children %}
                {% include "document_manager/produced/_node.html" with node=child %}
            {% endfor %}
        </ul>
    {% endif %}
</li>