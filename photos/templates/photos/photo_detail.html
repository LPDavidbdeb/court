{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load thumbnail %} {# Still load thumbnail for the detail view to show a larger image #}

{% block title %}Photo: {{ photo.file_name|default:'Untitled Photo' }}{% endblock %}

{% block content %}
    <h1 class="mb-4">Photo Details: {{ photo.file_name|default:'Untitled Photo' }}</h1>

    <div class="card mb-3">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6 text-center">
                    {% if photo.file %}
                        {% thumbnail photo.file "600x400" crop="center" as im %}
                            <img src="{{ im.url }}" class="img-fluid rounded border" alt="{{ photo.file_name|default:'Untitled Photo' }}">
                        {% endthumbnail %}
                        <p class="mt-2 text-muted small">Click <a href="{{ photo.file.url }}" target="_blank">here</a> to view original file.</p>
                    {% else %}
                        <p class="alert alert-warning">No image file uploaded for this photo.</p>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-4">File Name:</dt>
                        <dd class="col-sm-8">{{ photo.file_name }}</dd>

                        <dt class="col-sm-4">File Path:</dt>
                        <dd class="col-sm-8 text-break">{{ photo.file_path }}</dd>

                        <dt class="col-sm-4">Folder Path:</dt>
                        <dd class="col-sm-8 text-break">{{ photo.folder_path }}</dd>

                        <dt class="col-sm-4">File Size:</dt>
                        <dd class="col-sm-8">{{ photo.file_size|filesizeformat|default:"N/A" }}</dd>

                        <dt class="col-sm-4">Date Original:</dt>
                        <dd class="col-sm-8">{{ photo.datetime_original|date:"Y-m-d H:i"|default:"N/A" }}</dd>

                        <dt class="col-sm-4">Last Modified:</dt>
                        <dd class="col-sm-8">{{ photo.last_modified|date:"Y-m-d H:i"|default:"N/A" }}</dd>

                        <dt class="col-sm-4">Created On Disk:</dt>
                        <dd class="col-sm-8">{{ photo.created_on_disk|date:"Y-m-d H:i"|default:"N/A" }}</dd>

                        <dt class="col-sm-4">Dimensions:</dt>
                        <dd class="col-sm-8">{% if photo.width and photo.height %}{{ photo.width }}x{{ photo.height }}{% else %}N/A{% endif %}</dd>

                        <dt class="col-sm-4">Image Format:</dt>
                        <dd class="col-sm-8">{{ photo.image_format|default:"N/A" }}</dd>

                        <dt class="col-sm-4">Camera Make:</dt>
                        <dd class="col-sm-8">{{ photo.make|default:"N/A" }}</dd>

                        <dt class="col-sm-4">Camera Model:</dt>
                        <dd class="col-sm-8">{{ photo.model|default:"N/A" }}</dd>

                        <dt class="col-sm-4">ISO Speed:</dt>
                        <dd class="col-sm-8">{{ photo.iso_speed|default:"N/A" }}</dd>

                        <dt class="col-sm-4">GPS Location:</dt>
                        <dd class="col-sm-8">
                            {% if photo.gps_latitude and photo.gps_longitude %}
                                Lat: {{ photo.gps_latitude }}, Lon: {{ photo.gps_longitude }}
                                {% if photo.gps_altitude %}, Alt: {{ photo.gps_altitude }}m{% endif %}
                                {% comment %} You could add a link to Google Maps here if desired {% endcomment %}
                            {% else %}
                                N/A
                            {% endif %}
                        </dd>
                        {# Add more fields as desired #}
                    </dl>
                    {% if photo.all_metadata_json %}
                        <p class="mt-3"><strong>All Metadata (JSON):</strong></p>
                        <pre class="bg-light p-2 rounded small text-break">{{ photo.all_metadata_json|json_script:"photo_metadata" }}</pre>
                        {# You could add JS to pretty-print this JSON if it's large #}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <hr>
    <div class="mt-4">
        <a href="{% url 'photos:list' %}" class="btn btn-secondary me-2">Back to Photo List</a>
        <a href="{% url 'photos:update' pk=photo.pk %}" class="btn btn-warning me-2">Edit Photo</a>
        <a href="{% url 'photos:delete' pk=photo.pk %}" class="btn btn-danger">Delete Photo</a>
    </div>
{% endblock %}