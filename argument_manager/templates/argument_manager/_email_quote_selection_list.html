<div class="accordion" id="emailQuotesAccordion">
    {% for thread, quotes in grouped_quotes %}
        <div class="accordion-item">
            <h2 class="accordion-header" id="heading-{{ thread.pk }}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ thread.pk }}" aria-expanded="false" aria-controls="collapse-{{ thread.pk }}">
                    {{ thread.subject }} ({{ quotes|length }} quote{{ quotes|length|pluralize }}) - <small class="text-muted ms-2">{{ quotes.0.email.date_sent|date:"Y-m-d" }}</small>
                </button>
            </h2>
            <div id="collapse-{{ thread.pk }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ thread.pk }}" data-bs-parent="#emailQuotesAccordion">
                <div class="accordion-body">
                    <table class="table table-hover align-middle mb-0">
                        <tbody>
                            {% for quote in quotes %}
                                <tr>
                                    <td style="width: 5%;">
                                        <input class="form-check-input email-quote-select-checkbox" type="checkbox" value="{{ quote.pk }}" id="email_quote_check_{{ quote.pk }}">
                                    </td>
                                    <td>
                                        <label for="email_quote_check_{{ quote.pk }}" style="cursor: pointer; display: block;" class="w-100">
                                            <p class="mb-1">"{{ quote.quote_text }}"</p>
                                            <small class="text-muted">
                                                From: {{ quote.email.sender }} in 
                                                <a href="{{ quote.email.get_absolute_url }}" target="_blank" onclick="event.stopPropagation();" class="text-info">
                                                    {{ quote.email.subject|truncatechars:40 }}
                                                </a>
                                                on {{ quote.email.date_sent|date:"Y-m-d H:i" }}
                                            </small>
                                        </label>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% empty %}
        <p class="text-muted">No email quotes found.</p>
    {% endfor %}
</div>
